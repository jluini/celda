[gd_scene load_steps=16 format=2]

[ext_resource path="res://games/demo_game/rooms/room1/images/desk.png" type="Texture" id=1]
[ext_resource path="res://games/celda_escape/rooms/celda/images/gate.png" type="Texture" id=3]
[ext_resource path="res://tools/grog/room.gd" type="Script" id=4]
[ext_resource path="res://tools/2d/item2d.gd" type="Script" id=5]
[ext_resource path="res://games/celda_escape/rooms/celda/images/background.jpg" type="Texture" id=6]
[ext_resource path="res://games/celda_escape/rooms/celda/images/thing_erased.png" type="Texture" id=8]
[ext_resource path="res://games/celda_escape/rooms/celda/images/Cama.png" type="Texture" id=10]
[ext_resource path="res://games/celda_escape/rooms/celda/images/CeldaCelda.png" type="Texture" id=11]
[ext_resource path="res://games/celda_escape/rooms/celda/images/Inodoro.png" type="Texture" id=12]
[ext_resource path="res://games/celda_escape/rooms/celda/images/Cartel.png" type="Texture" id=13]

[sub_resource type="NavigationPolygon" id=1]
vertices = PoolVector2Array( 897.983, 762.257, 967.964, 804, 241.487, 805.672, 750.654, 758.574, 737.149, 635.8, 794.707, 677.744, 706.456, 676.315, 389.7, 634.572, 705.228, 714.375, 117.333, 568.755, 329.54, 574.413 )
polygons = [ PoolIntArray( 0, 1, 2, 3 ), PoolIntArray( 4, 5, 6, 7 ), PoolIntArray( 8, 3, 2, 7 ), PoolIntArray( 2, 9, 10, 7 ), PoolIntArray( 8, 7, 6 ) ]
outlines = [ PoolVector2Array( 967.964, 804, 897.983, 762.257, 750.654, 758.574, 705.228, 714.375, 706.456, 676.315, 794.707, 677.744, 737.149, 635.8, 389.7, 634.572, 329.54, 574.413, 117.333, 568.755, 241.487, 805.672 ) ]

[sub_resource type="Animation" id=2]
resource_name = "default"
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 1,
"values": [ null ]
}

[sub_resource type="Animation" id=3]
resource_name = "erased"
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 1,
"values": [ ExtResource( 8 ) ]
}

[sub_resource type="Animation" id=4]
resource_name = "default"

[sub_resource type="Animation" id=5]
resource_name = "open"

[node name="celda" type="Control"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -960.0
margin_right = 960.0
margin_bottom = 850.0
script = ExtResource( 4 )
__meta__ = {
"_edit_use_anchors_": false
}
default_player_position_path = NodePath("default_player_position")
navigation_path = NodePath("../celda/Navigation2D")

[node name="background" type="Control" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="ColorRect" type="ColorRect" parent="background"]
visible = false
anchor_right = 1.0
anchor_bottom = 1.0
color = Color( 0.215686, 0.133333, 0.054902, 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="background" type="TextureRect" parent="background"]
anchor_right = 1.0
anchor_bottom = 1.0
texture = ExtResource( 6 )
stretch_mode = 3
__meta__ = {
"_edit_use_anchors_": false
}

[node name="desk" type="Sprite" parent="background"]
visible = false
position = Vector2( 844, 405 )
z_index = 597
texture = ExtResource( 1 )
centered = false

[node name="gate" type="Sprite" parent="background"]
z_index = 740
texture = ExtResource( 3 )
centered = false

[node name="grid" type="Sprite" parent="background"]
position = Vector2( 1100.97, 444.995 )
z_index = 850
texture = ExtResource( 11 )

[node name="Navigation2D" type="Navigation2D" parent="."]

[node name="NavigationPolygonInstance" type="NavigationPolygonInstance" parent="Navigation2D"]
position = Vector2( 961.305, 29.1782 )
navpoly = SubResource( 1 )

[node name="default_player_position" type="Position2D" parent="."]
position = Vector2( 1143.49, 635.665 )

[node name="test_position" type="Position2D" parent="."]
position = Vector2( 113.997, 740.459 )

[node name="pos1" type="Position2D" parent="."]
position = Vector2( 1103.38, 605.697 )

[node name="pos2" type="Position2D" parent="."]
position = Vector2( 1231.45, 822.929 )

[node name="pos3" type="Position2D" parent="."]
position = Vector2( 1652.37, 767.605 )

[node name="items" type="Node2D" parent="."]

[node name="thing" type="Node2D" parent="items"]
position = Vector2( 1162.07, 233.242 )
z_index = 571
script = ExtResource( 5 )
item_key = "celda/thing"
instance_number = 0
color = Color( 1, 1, 1, 1 )
interact_angle = 22
code = "
look_at:
	if $inv_thing = 0:
		you.say CELDA_ESCAPE_NICE_THING
		self.say CELDA_ESCAPE_THING_THANKS
	else:
		you.say \"Está mal borrada.\"

pick_up:
	if $celda/mask:
		you.say \"No.\"
		you.say \"No frente a la máscara.\"
		.set reason_to_take_mask=true
	else:
		if $inv_thing = 0:
			self.play erased
			inv_thing.add
		
"
walk_speed = 0.0
radius = 70.0

[node name="interact_position" type="Position2D" parent="items/thing"]
position = Vector2( 24.5816, 389.081 )

[node name="speech_position" type="Position2D" parent="items/thing"]
position = Vector2( -0.0356827, -135.143 )

[node name="Sprite" type="Sprite" parent="items/thing"]

[node name="animation" type="AnimationPlayer" parent="items/thing"]
anims/default = SubResource( 2 )
anims/erased = SubResource( 3 )

[node name="exit" type="Node2D" parent="items"]
position = Vector2( 1726.48, 251.712 )
script = ExtResource( 5 )
item_key = "celda/exit"
instance_number = 0
color = Color( 1, 1, 1, 1 )
interact_angle = 0
code = "
look_at:
	you.say \"Es por donde me tengo que escapar.\"
	you.say \"Pero está cerrado.\"

open:
	.disable_input
	.wait 2
		
	.say \"Está trabada.\"
	
	.enable_input

use_with(inv_thing):
	.disable_input
	
	.wait 1 skippable=false
	you.say \"Tal vez con esta cosa puedo abrirlo.\" skippable=false
	.wait 3 skippable=false
	self.play open
	.set exit_is_open=true
	.wait 0.5
	.enable_input


walk_to:
	if $exit_is_open:
		you.say \"¡Me escapé!\" duration=3 skippable=false
		.say \"Game over.\"  duration=2 skippable=false
		.end"
walk_speed = 0.0
radius = 70.0

[node name="interact_position" type="Position2D" parent="items/exit"]
position = Vector2( -60.813, 434.711 )

[node name="animation" type="AnimationPlayer" parent="items/exit"]
anims/default = SubResource( 4 )
anims/open = SubResource( 5 )

[node name="cartel1" type="Sprite" parent="items/exit"]
texture = ExtResource( 13 )

[node name="door" type="Node2D" parent="items"]
position = Vector2( 555.421, 383.942 )
script = ExtResource( 5 )
item_key = "celda/door"
instance_number = 0
color = Color( 0.0313726, 0.0313726, 0.0313726, 1 )
interact_angle = 270
code = "
look_at:
	if $door_seen:
		you.say \"Ya te dije que es alta puerta.\"
	else:
		you.say \"Es alta puerta.\"
		.set door_seen=true

talk_to: TK
	.set number=$number+1
	if $number < 3:
		you.say \"¿Posta?\"
	else:
		you.say \"Bueno dale\"
	

pick_up: TK
	you.say \"¿Me decís en serio?\"

open:
	you.say \"Está cerrada con llave\"

close: TK
	you.say \"Ya está cerrada\""
walk_speed = 0.0
radius = 200.0

[node name="interact_position" type="Position2D" parent="items/door"]
position = Vector2( 10.0393, 239.253 )

[node name="bed" type="Node2D" parent="items"]
position = Vector2( 1508, 530 )
script = ExtResource( 5 )
item_key = "celda/bed"
instance_number = 0
color = Color( 1, 1, 1, 1 )
interact_angle = 270
code = "
look_at:
	you.say \"Es un escritorio de pino.\" duration=1.5
	you.say \"Detalle en los rieles de dos cajones.\" duration=1.5
	you.say \"Está con muy poco uso.\" duration=1.5
	you.say \"Se retira en mi domicilio\" duration=1.5

talk_to: TK
	.load_room exit
	you.teleport to=pos1
	.curtain_up
	you.walk to=pos2

	

pick_up:
	if $exit_is_open and $door_seen:
		you.say \"¿Para qué quiero más papeles si ya me puedo ir?\"
	else:
		if $inv_paper = 3:
			if $take_desc_attempts > 4:
				you.say \"Ya que insistís...\"
				inv_paper.add
			else:
				.set take_desc_attempts=$take_desc_attempts + 1
				you.say \"Creo que ya tengo demasiadas.\"
		else:
			inv_paper.add
	

use:
	self.set_tool use_with"
walk_speed = 0.0
radius = 150.0

[node name="interact_position" type="Position2D" parent="items/bed"]
position = Vector2( 15.6344, 153.356 )

[node name="Sprite" type="Sprite" parent="items/bed"]
position = Vector2( 0, 50 )
texture = ExtResource( 10 )

[node name="toilet" type="Node2D" parent="items"]
position = Vector2( 1775, 718 )
script = ExtResource( 5 )
item_key = "celda/toilet"
instance_number = 0
color = Color( 1, 1, 1, 1 )
interact_angle = 0
code = "look_at:
	you.say \"Alto inodoro.\"
	you.say \"Tal vez me pueda ecapar por el desagüe del mismo.\"
	you.say \"Mentira.\""
walk_speed = 0.0
radius = 60.0

[node name="interact_position" type="Position2D" parent="items/toilet"]
position = Vector2( -120.155, 82.8297 )

[node name="Sprite" type="Sprite" parent="items/toilet"]
position = Vector2( 0, -40 )
z_index = 773
texture = ExtResource( 12 )

[node name="gate" type="Node2D" parent="items"]
position = Vector2( 69.5315, 457.142 )
script = ExtResource( 5 )
item_key = "celda/gate"
instance_number = 0
color = Color( 0, 0, 0, 1 )
interact_angle = 180
code = ""
walk_speed = 0.0
radius = 150.0

[node name="interact_position" type="Position2D" parent="items/gate"]
position = Vector2( 5.38055, 128.475 )
