[gd_scene load_steps=14 format=2]

[ext_resource path="res://games/demo_game/rooms/room1/images/desk.png" type="Texture" id=1]
[ext_resource path="res://games/celda_escape/rooms/celda/images/gate.png" type="Texture" id=3]
[ext_resource path="res://tools/grog/room.gd" type="Script" id=4]
[ext_resource path="res://tools/2d/item2d.gd" type="Script" id=5]
[ext_resource path="res://games/celda_escape/rooms/celda/images/celdafondo.jpg" type="Texture" id=6]
[ext_resource path="res://icon.png" type="Texture" id=7]
[ext_resource path="res://games/celda_escape/rooms/celda/images/thing_erased.png" type="Texture" id=8]
[ext_resource path="res://games/celda_escape/rooms/celda/images/exit_open.png" type="Texture" id=9]

[sub_resource type="NavigationPolygon" id=1]
vertices = PoolVector2Array( 670.913, 578.145, 914.348, 787.213, -829.795, 791.509, 234.161, 618.24, -822.635, 674.087, -940.057, 570.985, -939.75, 503.444, -832.659, 499.386, -693.757, 575.281, 244.19, 576.673, -113.808, 626.832, -129.556, 575.385 )
polygons = [ PoolIntArray( 0, 1, 2, 3 ), PoolIntArray( 4, 5, 6, 7, 8 ), PoolIntArray( 3, 9, 0 ), PoolIntArray( 10, 3, 2, 4 ), PoolIntArray( 10, 4, 8, 11 ) ]
outlines = [ PoolVector2Array( -693.757, 575.281, -832.659, 499.386, -939.75, 503.444, -940.057, 570.985, -822.635, 674.087, -829.795, 791.509, 914.348, 787.213, 670.913, 578.145, 244.19, 576.673, 234.161, 618.24, -113.808, 626.832, -129.556, 575.385 ) ]

[sub_resource type="Animation" id=2]
resource_name = "default"
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 1,
"values": [ null ]
}

[sub_resource type="Animation" id=3]
resource_name = "erased"
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 1,
"values": [ ExtResource( 8 ) ]
}

[sub_resource type="Animation" id=4]
resource_name = "default"
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 1,
"values": [ null ]
}

[sub_resource type="Animation" id=5]
resource_name = "open"
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:texture")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 1,
"values": [ ExtResource( 9 ) ]
}

[node name="celda" type="Control"]
anchor_left = 0.5
anchor_right = 0.5
margin_left = -960.0
margin_right = 960.0
margin_bottom = 850.0
script = ExtResource( 4 )
__meta__ = {
"_edit_use_anchors_": false
}
default_player_position_path = NodePath("default_player_position")
navigation_path = NodePath("../celda/Navigation2D")

[node name="background" type="Control" parent="."]
anchor_right = 1.0
anchor_bottom = 1.0
__meta__ = {
"_edit_use_anchors_": false
}

[node name="ColorRect" type="ColorRect" parent="background"]
visible = false
anchor_right = 1.0
anchor_bottom = 1.0
color = Color( 0.215686, 0.133333, 0.054902, 1 )
__meta__ = {
"_edit_use_anchors_": false
}

[node name="background" type="TextureRect" parent="background"]
anchor_right = 1.0
anchor_bottom = 1.0
texture = ExtResource( 6 )
stretch_mode = 3
__meta__ = {
"_edit_use_anchors_": false
}

[node name="desk" type="Sprite" parent="background"]
position = Vector2( 844, 405 )
z_index = 597
texture = ExtResource( 1 )
centered = false

[node name="gate" type="Sprite" parent="background"]
position = Vector2( -1, -36.916 )
z_index = 1000
texture = ExtResource( 3 )
centered = false

[node name="Navigation2D" type="Navigation2D" parent="."]

[node name="NavigationPolygonInstance" type="NavigationPolygonInstance" parent="Navigation2D"]
position = Vector2( 961.305, 29.1782 )
navpoly = SubResource( 1 )

[node name="default_player_position" type="Position2D" parent="."]
position = Vector2( 246.692, 699.315 )

[node name="pos1" type="Position2D" parent="."]
position = Vector2( 697.843, 718.947 )

[node name="pos2" type="Position2D" parent="."]
position = Vector2( 913.596, 718.352 )

[node name="pos3" type="Position2D" parent="."]
position = Vector2( 1206.05, 586.552 )

[node name="items" type="Node2D" parent="."]

[node name="thing" type="Node2D" parent="items"]
position = Vector2( 1730.51, 418.63 )
z_index = 571
z_as_relative = false
script = ExtResource( 5 )
global_id = "celda/thing"
color = Color( 1, 1, 1, 1 )
interact_angle = 22
code = "
look_at:
	if $inv_thing = 0:
		you.say CELDA_ESCAPE_NICE_THING
		self.say CELDA_ESCAPE_THING_THANKS
	else:
	you.say \"Está mal borrada.\"

pick_up:
	if $celda/mask:
		you.say \"No.\"
		you.say \"No frente a la máscara.\"
		.set reason_to_take_mask=true
	else:
		if $inv_thing = 0:
			self.play erased
			.add inv_thing
		
"
walk_speed = 0.0
radius = 70.0

[node name="interact_position" type="Position2D" parent="items/thing"]
position = Vector2( -89.2092, 261.127 )

[node name="speech_position" type="Position2D" parent="items/thing"]
position = Vector2( -0.0356827, -135.143 )

[node name="Sprite" type="Sprite" parent="items/thing"]

[node name="animation" type="AnimationPlayer" parent="items/thing"]
anims/default = SubResource( 2 )
anims/erased = SubResource( 3 )

[node name="exit" type="Node2D" parent="items"]
position = Vector2( 1521.06, 219.063 )
z_index = 571
z_as_relative = false
script = ExtResource( 5 )
global_id = "celda/exit"
color = Color( 1, 1, 1, 1 )
interact_angle = 270
code = "
look_at:
	you.say \"Es por donde me tengo que escapar.\"
	you.say \"Pero está cerrado.\"

open:
	.disable_input
	
	if $inv_thing:
		.wait 1 skippable=false
		you.say \"Tal vez con esta cosa puedo abrirlo.\" skippable=false
		.wait 3 skippable=false
		self.play open
		.set exit_is_open=true
		
		
	else:
		.wait 2
		
		.say \"Está trabada.\"
	
	.enable_input

walk_to:
	if $exit_is_open:
		you.say \"¡Me escapé!\" duration=3 skippable=false
		.say \"Game over.\"  duration=2 skippable=false
		.end"
walk_speed = 0.0
radius = 70.0

[node name="interact_position" type="Position2D" parent="items/exit"]
position = Vector2( -6.39816, 403.422 )

[node name="Sprite" type="Sprite" parent="items/exit"]

[node name="animation" type="AnimationPlayer" parent="items/exit"]
anims/default = SubResource( 4 )
anims/open = SubResource( 5 )

[node name="mask" type="Node2D" parent="items"]
position = Vector2( 1560.19, 428.746 )
z_index = 571
z_as_relative = false
script = ExtResource( 5 )
global_id = "celda/mask"
color = Color( 0.0313726, 0.0313726, 0.0313726, 1 )
interact_angle = 315
code = "look_at:
	you.say DEMO_GAME_MASK

pick_up:
	if $reason_to_take_mask:
		you.say \"Bueno, la saco.\"
		self.disable
		.add inv_mask
	else:
		you.say \"¿Para qué querría agarrarla?\"
"
walk_speed = 0.0
radius = 45.0

[node name="interact_position" type="Position2D" parent="items/mask"]
position = Vector2( -57.0124, 193.758 )

[node name="Sprite" type="Sprite" parent="items/mask"]
texture = ExtResource( 7 )

[node name="door" type="Node2D" parent="items"]
position = Vector2( 555.421, 383.942 )
z_index = 571
z_as_relative = false
script = ExtResource( 5 )
global_id = "celda/door1"
color = Color( 0.0313726, 0.0313726, 0.0313726, 1 )
interact_angle = 270
code = "
look_at:
	.set var=door_seen
	if $$var:
		you.say \"Ya te dije que es alta puerta.\"
	else:
		you.say \"Es alta puerta.\"
		.set door_seen=true

talk_to: TK
	.set number=$number+1
	if $number < 3:
		you.say \"¿Posta?\"
	else:
		you.say \"Bueno dale\"
	
	

pick_up: TK
	you.say \"¿Me decís en serio?\"

open:
	you.say \"Está cerrada con llave\"

close: TK
	you.say \"Ya está cerrada\""
walk_speed = 0.0
radius = 200.0

[node name="interact_position" type="Position2D" parent="items/door"]
position = Vector2( 10.0393, 239.253 )

[node name="desk" type="Node2D" parent="items"]
position = Vector2( 1020.81, 522.843 )
z_index = 571
z_as_relative = false
script = ExtResource( 5 )
global_id = "celda/desk"
color = Color( 0.0313726, 0.0313726, 0.0313726, 1 )
interact_angle = 270
code = "
look_at:
	you.say \"Es un escritorio de pino.\" duration=1.5
	you.say \"Detalle en los rieles de dos cajones.\" duration=1.5
	you.say \"Está con muy poco uso.\" duration=1.5
	you.say \"Se retira en mi domicilio\" duration=1.5

talk_to: TK
	you.say \"¿Posta?\"

pick_up:
	if $inv_paper < 3:
		.add inv_paper
	else:
		you.say \"Creo que ya tengo demasiadas.\""
walk_speed = 0.0
radius = 150.0

[node name="interact_position" type="Position2D" parent="items/desk"]
position = Vector2( -8.57617, 146.175 )

[node name="gate" type="Node2D" parent="items"]
position = Vector2( 98.5408, 452.62 )
script = ExtResource( 5 )
global_id = "celda/gate"
interact_angle = 180
code = "
walk_to:
	.load_room exit"
walk_speed = 0.0
radius = 200.0

[node name="interact_position" type="Position2D" parent="items/gate"]
position = Vector2( 138.625, 215.454 )
